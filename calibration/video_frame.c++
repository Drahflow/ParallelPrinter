#include "video_frame.h"

using namespace std;

// effective size: 6x13
static const uint8_t font[13 * (128 - 32)] = {
  // Space
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
  // !
  0, 0, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x00, 0x04, 0, 0,
  // "
  0, 0, 0x0a, 0x0a, 0x0a, 0, 0, 0, 0, 0, 0, 0, 0,
  // #
  0, 0, 0x00, 0x0a, 0x0a, 0x1f, 0x0a, 0x1f, 0x0a, 0x0a, 0x00, 0, 0,
  // $
  0, 0, 0x04, 0x1e, 0x05, 0x05, 0x0e, 0x14, 0x14, 0x0f, 0x04, 0, 0,
  // %
  0, 0, 0x12, 0x15, 0x0a, 0x08, 0x04, 0x02, 0x0a, 0x15, 0x09, 0, 0,
  // &
  0, 0, 0x00, 0x02, 0x05, 0x05, 0x02, 0x05, 0x19, 0x09, 0x16, 0, 0,
  // '
  0, 0, 0x04, 0x04, 0x04, 0, 0, 0, 0, 0, 0, 0, 0,
  // (
  0, 0x08, 0x04, 0x04, 0x02, 0x02, 0x02, 0x02, 0x02, 0x04, 0x04, 0x08, 0,
  // )
  0, 0x02, 0x04, 0x04, 0x08, 0x08, 0x08, 0x08, 0x08, 0x04, 0x04, 0x02, 0,
  // *
  0, 0, 0x04, 0x15, 0x0e, 0x15, 0x04, 0, 0, 0, 0, 0, 0,
  // +
  0, 0, 0, 0, 0x04, 0x04, 0x1f, 0x04, 0x04, 0, 0, 0, 0,
  // ,
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0x0c, 0x04, 0x02, 0,
  // -
  0, 0, 0, 0, 0, 0, 0x1f, 0, 0, 0, 0, 0, 0,
  // .
  0, 0, 0, 0, 0, 0, 0, 0, 0x04, 0x0e, 0x04, 0, 0,
  // /
  0, 0, 0x10, 0x10, 0x08, 0x08, 0x04, 0x02, 0x02, 0x01, 0x01, 0, 0,
  // 0
  0, 0, 0x04, 0x0a, 0x11, 0x11, 0x11, 0x11, 0x11, 0x0a, 0x04, 0, 0,
  // 1
  0, 0, 0x04, 0x06, 0x05, 0x04, 0x04, 0x04, 0x04, 0x04, 0x1f, 0, 0,
  // 2
  0, 0, 0x0e, 0x11, 0x11, 0x10, 0x08, 0x04, 0x02, 0x01, 0x1f, 0, 0,
  // 3
  0, 0, 0x1f, 0x10, 0x08, 0x04, 0x0e, 0x10, 0x10, 0x11, 0x0e, 0, 0,
  // 4
  0, 0, 0x08, 0x08, 0x0c, 0x0a, 0x0a, 0x09, 0x1f, 0x08, 0x08, 0, 0,
  // 5
  0, 0, 0x1f, 0x01, 0x01, 0x0d, 0x13, 0x10, 0x10, 0x11, 0x0e, 0, 0,
  // 6
  0, 0, 0x0e, 0x11, 0x01, 0x01, 0x0f, 0x11, 0x11, 0x11, 0x0e, 0, 0,
  // 7
  0, 0, 0x1f, 0x10, 0x08, 0x08, 0x04, 0x04, 0x02, 0x02, 0x02, 0, 0,
  // 8
  0, 0, 0x0e, 0x11, 0x11, 0x11, 0x0e, 0x11, 0x11, 0x11, 0x0e, 0, 0,
  // 9
  0, 0, 0x0e, 0x11, 0x11, 0x11, 0x1e, 0x10, 0x10, 0x11, 0x0e, 0, 0,
  // :
  0, 0, 0, 0, 0x04, 0x0e, 0x04, 0, 0, 0x04, 0x0e, 0x04, 0,
  // ;
  0, 0, 0, 0, 0x04, 0x0e, 0x04, 0, 0, 0x0c, 0x04, 0x02, 0,
  // <
  0, 0, 0x10, 0x08, 0x04, 0x02, 0x01, 0x02, 0x04, 0x08, 0x10, 0, 0,
  // =
  0, 0, 0, 0, 0, 0x1f, 0, 0x1f, 0, 0, 0, 0, 0,
  // >
  0, 0, 0x01, 0x02, 0x04, 0x08, 0x10, 0x08, 0x04, 0x02, 0x01, 0, 0,
  // ?
  0, 0, 0x0e, 0x11, 0x11, 0x10, 0x08, 0x04, 0x04, 0x00, 0x04, 0, 0,
  // @
  0, 0, 0x0e, 0x11, 0x11, 0x19, 0x15, 0x15, 0x0d, 0x01, 0x1e, 0, 0,
  // A
  0, 0, 0x04, 0x0a, 0x11, 0x11, 0x11, 0x1f, 0x11, 0x11, 0x11, 0, 0,
  // B
  0, 0, 0x0f, 0x12, 0x12, 0x12, 0x0e, 0x12, 0x12, 0x12, 0x0f, 0, 0,
  // C
  0, 0, 0x0e, 0x11, 0x01, 0x01, 0x01, 0x01, 0x01, 0x11, 0x0e, 0, 0,
  // D
  0, 0, 0x0f, 0x12, 0x12, 0x12, 0x12, 0x12, 0x12, 0x12, 0x0f, 0, 0,
  // E
  0, 0, 0x1f, 0x01, 0x01, 0x01, 0x0f, 0x01, 0x01, 0x01, 0x1f, 0, 0,
  // F
  0, 0, 0x1f, 0x01, 0x01, 0x01, 0x0f, 0x01, 0x01, 0x01, 0x01, 0, 0,
  // G
  0, 0, 0x0e, 0x11, 0x01, 0x01, 0x01, 0x19, 0x11, 0x11, 0x0e, 0, 0,
  // H
  0, 0, 0x11, 0x11, 0x11, 0x11, 0x1f, 0x11, 0x11, 0x11, 0x11, 0, 0,
  // I
  0, 0, 0x0e, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x0e, 0, 0,
  // J
  0, 0, 0x1c, 0x08, 0x08, 0x08, 0x08, 0x08, 0x08, 0x09, 0x06, 0, 0,
  // K
  0, 0, 0x11, 0x11, 0x09, 0x05, 0x03, 0x05, 0x09, 0x11, 0x11, 0, 0,
  // L
  0, 0, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x1f, 0, 0,
  // M
  0, 0, 0x11, 0x11, 0x1d, 0x15, 0x15, 0x11, 0x11, 0x11, 0x11, 0, 0,
  // N
  0, 0, 0x11, 0x13, 0x13, 0x15, 0x15, 0x19, 0x19, 0x11, 0x11, 0, 0,
  // O
  0, 0, 0x0e, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x0e, 0, 0,
  // P
  0, 0, 0x0f, 0x11, 0x11, 0x11, 0x0f, 0x01, 0x01, 0x01, 0x01, 0, 0,
  // Q
  0, 0, 0x0e, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x15, 0x0e, 0x10, 0,
  // R
  0, 0, 0x0f, 0x11, 0x11, 0x11, 0x0f, 0x05, 0x09, 0x11, 0x11, 0, 0,
  // S
  0, 0, 0x0e, 0x11, 0x01, 0x01, 0x0e, 0x10, 0x10, 0x11, 0x0e, 0, 0,
  // T
  0, 0, 0x1f, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0, 0,
  // U
  0, 0, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x0e, 0, 0,
  // V
  0, 0, 0x11, 0x11, 0x11, 0x11, 0x0a, 0x0a, 0x0a, 0x04, 0x04, 0, 0,
  // W
  0, 0, 0x11, 0x11, 0x11, 0x11, 0x15, 0x15, 0x15, 0x15, 0x0a, 0, 0,
  // X
  0, 0, 0x11, 0x11, 0x0a, 0x0a, 0x04, 0x0a, 0x0a, 0x11, 0x11, 0, 0,
  // Y
  0, 0, 0x11, 0x11, 0x0a, 0x0a, 0x04, 0x04, 0x04, 0x04, 0x04, 0, 0,
  // Z
  0, 0, 0x1f, 0x10, 0x08, 0x08, 0x04, 0x02, 0x02, 0x01, 0x1f, 0, 0,
  // [
  0, 0x0e, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x0e, 0,
  // backslash
  0, 0, 0x01, 0x01, 0x02, 0x02, 0x04, 0x08, 0x08, 0x10, 0x10, 0, 0,
  // ]
  0, 0x0e, 0x08, 0x08, 0x08, 0x08, 0x08, 0x08, 0x08, 0x08, 0x08, 0x0e, 0,
  // ^
  0, 0, 0x04, 0x0a, 0x11, 0, 0, 0, 0, 0, 0, 0, 0,
  // _
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0x1f, 0,
  // `
  0, 0x04, 0x08, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
  // a
  0, 0, 0, 0, 0, 0x0e, 0x10, 0x1e, 0x11, 0x19, 0x16, 0, 0,
  // b
  0, 0, 0x01, 0x01, 0x01, 0x0f, 0x11, 0x11, 0x11, 0x11, 0x0e, 0, 0,
  // c
  0, 0, 0, 0, 0, 0x0e, 0x11, 0x01, 0x01, 0x11, 0x0e, 0, 0,
  // d
  0, 0, 0x10, 0x10, 0x10, 0x1e, 0x11, 0x11, 0x11, 0x11, 0x1e, 0, 0,
  // e
  0, 0, 0, 0, 0, 0x0e, 0x11, 0x1f, 0x01, 0x11, 0x0e, 0, 0,
  // f
  0, 0, 0x0c, 0x12, 0x02, 0x02, 0x0f, 0x02, 0x02, 0x02, 0x02, 0, 0,
  // g
  0, 0, 0, 0, 0, 0x0e, 0x11, 0x11, 0x11, 0x1e, 0x10, 0x11, 0x0e,
  // h
  0, 0, 0x01, 0x01, 0x01, 0x0d, 0x13, 0x11, 0x11, 0x11, 0x11, 0, 0,
  // i
  0, 0, 0, 0x04, 0x00, 0x06, 0x04, 0x04, 0x04, 0x04, 0x0e, 0, 0,
  // j
  0, 0, 0, 0x08, 0x00, 0x0c, 0x08, 0x08, 0x08, 0x08, 0x09, 0x09, 0x06,
  // k
  0, 0, 0x01, 0x01, 0x01, 0x09, 0x05, 0x03, 0x05, 0x09, 0x11, 0, 0,
  // l
  0, 0, 0x06, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x0e, 0, 0,
  // m
  0, 0, 0, 0, 0, 0x0b, 0x15, 0x15, 0x15, 0x15, 0x11, 0, 0,
  // n
  0, 0, 0, 0, 0, 0x0d, 0x13, 0x11, 0x11, 0x11, 0x11, 0, 0,
  // o
  0, 0, 0, 0, 0, 0x0e, 0x11, 0x11, 0x11, 0x11, 0x0e, 0, 0,
  // p
  0, 0, 0, 0, 0, 0x0f, 0x11, 0x11, 0x11, 0x0f, 0x01, 0x01, 0x01,
  // q
  0, 0, 0, 0, 0, 0x1e, 0x11, 0x11, 0x11, 0x1e, 0x10, 0x10, 0x10,
  // r
  0, 0, 0, 0, 0, 0x0d, 0x13, 0x01, 0x01, 0x01, 0x01, 0, 0,
  // s
  0, 0, 0, 0, 0, 0x0e, 0x11, 0x06, 0x08, 0x11, 0x0e, 0, 0,
  // t
  0, 0, 0, 0x02, 0x02, 0x0f, 0x02, 0x02, 0x02, 0x12, 0x0c, 0, 0,
  // u
  0, 0, 0, 0, 0, 0x11, 0x11, 0x11, 0x11, 0x19, 0x16, 0, 0,
  // v
  0, 0, 0, 0, 0, 0x11, 0x11, 0x11, 0x0a, 0x0a, 0x04, 0, 0,
  // w
  0, 0, 0, 0, 0, 0x11, 0x11, 0x15, 0x15, 0x15, 0x0a, 0, 0,
  // x
  0, 0, 0, 0, 0, 0x11, 0x0a, 0x04, 0x04, 0x0a, 0x11, 0, 0,
  // y
  0, 0, 0, 0, 0, 0x11, 0x11, 0x11, 0x19, 0x16, 0x10, 0x11, 0x0e,
  // z
  0, 0, 0, 0, 0, 0x1f, 0x08, 0x04, 0x02, 0x01, 0x1f, 0, 0,
  // {
  0, 0x18, 0x04, 0x04, 0x04, 0x04, 0x03, 0x04, 0x04, 0x04, 0x04, 0x18, 0,
  // |
  0, 0, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0, 0,
  // }
  0, 0x03, 0x04, 0x04, 0x04, 0x04, 0x18, 0x04, 0x04, 0x04, 0x04, 0x03, 0,
  // ~
  0, 0, 0x12, 0x15, 0x09, 0, 0, 0, 0, 0, 0, 0, 0,
};

void VideoFrame::renderText(int x, int y, const string &str) {
  for(int yy = y; yy < y + 15; ++yy) {
    for(unsigned int xx = x; xx < x + 7 * str.size(); ++xx) {
      if(xx >= videoWidth) break;

      data[yy * videoWidth * 2 + xx * 2] = 16;
      data[yy * videoWidth * 2 + xx * 2 + 1] = 128;
    }
  }

  for(unsigned int i = 0; i < str.size(); ++i) {
    for(int r = 0; r < 13; ++r) {
      int character = str[i];
      if(character < 32 || character > 127) character = '?';
      int bits = font[13 * (character - 32) + r];

      for(int c = 0; c < 6; ++c) {
        if(bits & 1) data[(y + 1 + r) * videoWidth * 2 + (x + 7 * i + c) * 2] = 255;
        bits >>= 1;
      }
    }
  }
}
