###
# Calibration setup
# netcat -lp 4000 | ./yuvreceive
connect:printer /dev/ttyACM0
connect:log calibration.log
connect:microscope /dev/video0
connect:video 192.168.3.11:4000
connect:tablet
tablet /data/local/tmp/su
tablet /data/local/tmp/tabletTarget

log:placement 0
tablet target 20 20
status:steps
###

motors:on

config:motor 0 256 8
config:motor 1 256 8
config:motor 2 256 8
config:motor 3 256 16
config:motor 4 256 8
config:motor 5 256 8
config:motor 6 256 8

config:endstop:init_duration 400
config:homing:threshold 3000 3050 3050 3200 3300 30000
config:homing:scan 50 0 73300775 0 0
config:homing:clear 30000 0 73300775 0 0
config:homing:fine 1 0 73300775 0 0
# 10 RPM
# config:interactive:big_step 3839 0 0 52776 0 23039 0 1319413953 0 0 3840 0 1319413953 4294914520 0
# 180 RPM
config:interactive:big_step 3839 0 0 52776 0 8000 0 1319413953 0 0 3840 0 1319413953 4294914520 0
tick:on

homing:up
# wait for completion

config:kinematics:slider:zero 0 -300 -27 -165.6
config:kinematics:slider:zero 1 -200 -27 -75.6
config:kinematics:slider:zero 2 -100 -27 -119.5
config:kinematics:slider:zero 3 0 -27 -150.3
config:kinematics:slider:zero 4 100 -27 -119.5
config:kinematics:slider:zero 5 200 -27 -75.6
config:kinematics:slider:zero 6 300 -27 -165.6

config:kinematics:slider:up 0 0 0 0.0000341796875
config:kinematics:slider:up 1 0 0 0.0000341796875
config:kinematics:slider:up 2 0 0 0.0000341796875
config:kinematics:slider:up 3 0 0 0.0000341796875
config:kinematics:slider:up 4 0 0 0.0000341796875
config:kinematics:slider:up 5 0 0 0.0000341796875
config:kinematics:slider:up 6 0 0 0.0000341796875

config:kinematics:limit:upper 0 6000000
config:kinematics:limit:upper 1 6000000
config:kinematics:limit:upper 2 6000000
config:kinematics:limit:upper 3 6000000
config:kinematics:limit:upper 4 6000000
config:kinematics:limit:upper 5 6000000
config:kinematics:limit:upper 6 6000000

config:kinematics:limit:lower 0 -18000000
config:kinematics:limit:lower 1 -18000000
config:kinematics:limit:lower 2 -18000000
config:kinematics:limit:lower 3 -18000000
config:kinematics:limit:lower 4 -18000000
config:kinematics:limit:lower 5 -18000000
config:kinematics:limit:lower 6 -18000000

config:kinematics:limit:force 0 30
config:kinematics:limit:force 1 30
config:kinematics:limit:force 2 30
config:kinematics:limit:force 3 30
config:kinematics:limit:force 4 30
config:kinematics:limit:force 5 30
config:kinematics:limit:force 6 30

config:kinematics:attachment 0 -200 -35 -40
config:kinematics:attachment 1 -175 -35 40
config:kinematics:attachment 2 -95 -85.61 -45
config:kinematics:attachment 3 0 -33.0 -35
config:kinematics:attachment 4 95 -85.61 -45
config:kinematics:attachment 5 175 -35 40
config:kinematics:attachment 6 200 -35 -40

config:kinematics:strut:backslash 0 0.9
config:kinematics:strut:backslash 1 0.9
config:kinematics:strut:backslash 2 0.9
config:kinematics:strut:backslash 3 0.9
config:kinematics:strut:backslash 4 0.9
config:kinematics:strut:backslash 5 0.9
config:kinematics:strut:backslash 6 0.9

config:kinematics:strut:elasticity 0 0.5
config:kinematics:strut:elasticity 1 0.5
config:kinematics:strut:elasticity 2 0.5
config:kinematics:strut:elasticity 3 0.5
config:kinematics:strut:elasticity 4 0.5
config:kinematics:strut:elasticity 5 0.5
config:kinematics:strut:elasticity 6 0.5

config:kinematics:center_of_mass 0 5 -10 10

config:kinematics:strut 0 482.52
config:kinematics:strut 1 482.52
config:kinematics:strut 2 516
config:kinematics:strut 3 482.52
config:kinematics:strut 4 516
config:kinematics:strut 5 482.52
config:kinematics:strut 6 482.52

config:kinematics:interval 0.05
# config:kinematics:limit:steps_per_second 51200
config:kinematics:limit:steps_per_second 20000

kinematics:zero 0 75 -590 1 0 0 0

config:motor 0 256 16
config:motor 1 256 16
config:motor 2 256 16
config:motor 3 256 16
config:motor 4 256 16
config:motor 5 256 16
config:motor 6 256 16

kinematics:again

config:kinematics:slider:zero 6 300 -27 -167.8

kinematics:again

# manual experiments

tool:speed:movement 1
tool:speed:rotation 0.3
tool:attached 240 30 -45 1 0 0 0

# # platform tilt 10 degrees
# tool:move 240 105.0 -635 0.9961946980917455 -0.08715574274765817 0 0
# # and back
tool:move 240 105.0 -635 1 0 0 0

# extend forward, 1cm
tool:move 240 115.0 -635 1 0 0 0

# extend forward, 5cm
tool:move 240 125.0 -635 1 0 0 0
tool:move 240 135.0 -635 1 0 0 0
tool:move 240 145.0 -635 1 0 0 0
tool:move 240 155.0 -635 1 0 0 0

# extend forward, another 5cm
tool:move 240 165.0 -635 1 0 0 0
tool:move 240 175.0 -635 1 0 0 0
tool:move 240 185.0 -635 1 0 0 0
tool:move 240 195.0 -635 1 0 0 0
tool:move 240 205.0 -635 1 0 0 0

config:kinematics:slider:zero 2 -100 -27 -118.5
config:kinematics:slider:zero 3 0 -27 -149.8
config:kinematics:slider:zero 4 100 -27 -120.5
config:kinematics:slider:zero 6 300 -27 -168.8

kinematics:again

# extend forward, another 5cm
tool:move 240 215.0 -635 1 0 0 0
tool:move 240 225.0 -635 1 0 0 0
tool:move 240 235.0 -635 1 0 0 0
tool:move 240 245.0 -635 1 0 0 0
tool:move 240 255.0 -635 1 0 0 0

# reaching tablet
tool:move 240 300.0 -635 1 0 0 0
tool:move 240 350.0 -635 1 0 0 0
tool:move 240 350.0 -700 1 0 0 0
tool:move 240 350.0 -750 1 0 0 0
tool:move 240 350.0 -780 1 0 0 0
tool:move 240 350.0 -790 1 0 0 0
tool:move 260 350.0 -790 1 0 0 0
tool:move 300 350.0 -790 1 0 0 0
tool:move 340 350.0 -790 1 0 0 0
tool:move 340 390.0 -790 1 0 0 0
tool:move 340 390.0 -800 1 0 0 0
tool:move 340 390.0 -801 1 0 0 0
tool:move 340 391.0 -801 1 0 0 0
tool:move 340 392.0 -801 1 0 0 0
tool:move 340 392.2 -801 1 0 0 0
tool:move 340.5 392.2 -801 1 0 0 0
tool:move 341 392.2 -801 1 0 0 0
tool:move 342 392 -801 1 0 0 0
tool:move 350 391.8 -801.4 1 0 0 0
tool:move 355 391.6 -801.6 1 0 0 0
tool:move 360 391.4 -801.8 1 0 0 0
tool:move 365 391.2 -802.0 1 0 0 0
tool:move 370 391.0 -802.2 1 0 0 0
tool:move 375 390.8 -802.4 1 0 0 0
tool:move 380 390.6 -802.7 1 0 0 0
tool:move 385 390.4 -802.9 1 0 0 0
tool:move 390 390.2 -803.2 1 0 0 0
tool:move 391 390.2 -803.2 1 0 0 0
tool:move 391 390.0 -803.2 1 0 0 0
tool:move 391 390.0 -803.25 1 0 0 0

tool:speed:movement 0.02
tool:move 391 390.0 -803.275 1 0 0 0
tool:move 391 390.0 -803.285 1 0 0 0
tool:move 391 390.0 -803.290 1 0 0 0
tool:move 391 390.0 -803.295 1 0 0 0
tool:move 391 390.0 -803.300 1 0 0 0
tool:move 391 390.0 -803.292 1 0 0 0
tool:move 392 390.0 -803.288 1 0 0 0
tool:move 392 389.9 -803.288 1 0 0 0
tool:move 392 389.9 -803.000 1 0 0 0
tool:move 392 390.0 -802.950 1 0 0 0
focus:auto -803.6 0.05
tool:move 392 390.0 -803.200 1 0 0 0
focus:auto -803.35 0.005
tool:move 392 390.0 -803.240 1 0 0 0
focus:auto -803.26 0.001
tool:speed:movement 0.001
tool:move 392 390.0 -803.249 1 0 0 0
focus:auto -803.26 0.0001

tool:speed:movement 0.002
tool:move 392 390.0 -803.241 1 0 0 0
focus:auto -803.249 0.0001

tool:speed:movement 3
tool:move 392 390.0 -750 1 0 0 0
tool:move 240 390.0 -750 1 0 0 0
tool:move 240 390.0 -635 1 0 0 0
tool:move 240 250.0 -635 1 0 0 0

tool:speed:movement 1
tool:move 240 155.0 -635 1 0 0 0
tool:move 240 105.0 -635 1 0 0 0
